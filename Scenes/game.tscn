[gd_scene load_steps=15 format=3 uid="uid://b1mh36mwq3q24"]

[ext_resource type="Script" uid="uid://c5rvkoyk7fbe8" path="res://Scripts/Managers/SimManager.cs" id="1_o5yvi"]
[ext_resource type="Texture2D" uid="uid://cijdk3pvlrko" path="res://Sprites/Borders.png" id="2_rku1e"]
[ext_resource type="Script" uid="uid://dvd0mpgaq08hr" path="res://Scripts/Managers/WorldGeneration.cs" id="3_rfjv2"]
[ext_resource type="TileSet" uid="uid://ddvui44w3eoj6" path="res://Scenes/main.tres" id="4_1phco"]
[ext_resource type="Script" uid="uid://coij55xtv1x1s" path="res://Scripts/terrain_map.gd" id="5_nb51f"]
[ext_resource type="Script" uid="uid://blcppmgbqb27u" path="res://Scripts/UI/camera_controller.gd" id="6_nnt18"]
[ext_resource type="Script" uid="uid://c0oiega1yip5i" path="res://Scripts/Managers/TimeManager.cs" id="7_ewbju"]
[ext_resource type="Script" uid="uid://dway8iihrur67" path="res://Scripts/UI/population_label.gd" id="8_85qyi"]
[ext_resource type="Script" uid="uid://dwax1c6st6gtk" path="res://Scripts/DebugLabel.cs" id="9_iivbl"]
[ext_resource type="Script" uid="uid://vt1lv4bf6jeb" path="res://Scripts/UI/date_label.gd" id="10_7nbq1"]
[ext_resource type="Script" uid="uid://cn00mfk0hsqbx" path="res://Scripts/UI/tps_label.gd" id="11_exi56"]

[sub_resource type="GDScript" id="GDScript_ynf5e"]
script/source = "extends Node

var modsPath : String = \"res://Mods/\"
var validModPaths := []
var modids := []

func _ready() -> void:
	pass
	#loadMods(modsPath)
	#print(\"Mod loading complete: Succesfully loaded \" + str(validModPaths.size()) + \" mods\")

func loadMods(path : String) -> void:
	if DirAccess.dir_exists_absolute(path):
		print(\"Found \" + str(DirAccess.get_directories_at(path).size()) + \" directories\")
		for mod in DirAccess.get_directories_at(path):
			var modPath : String = modsPath + mod
			if DirAccess.dir_exists_absolute(modPath):
				var modJsonPath : String = modPath + \"/mod.json\"
				if (FileAccess.file_exists(modJsonPath)):
					var modJsonFile := FileAccess.open(modJsonPath, FileAccess.READ)
					var modData : Dictionary = JSON.parse_string(modJsonFile.get_as_text())
					
					if modData is Dictionary and modData.has(\"author\") and modData.has(\"version\") and modData.has(\"modid\") and modData.has(\"name\"):
						if (!modids.has(modData[\"modid\"])):
							print(\"Succesfully loaded \" + modData[\"name\"] + \" by \" + modData[\"author\"])
							print(\"Version: \" + str(modData[\"version\"]))
							if modData.has(\"description\"):
								print(\"Description: \" + modData[\"description\"])
							
							validModPaths.append(modPath)
							modids.append(modData[\"modid\"])
						else:
							print(\"Mod id already in use!\")
					else:
						print(\"Error loading mod \" + mod + \": mod.json invalid\")
				else:
					print(\"Error loading mod \" + mod + \": mod.json not found\")
			else:
				print(\"Error loading mod \" + mod + \": Path invalid\")
	else:
		print(\"Error loading mods: mods directory invalid\")
"

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_d1ilt"]
texture = ExtResource("2_rku1e")
texture_region_size = Vector2i(8, 8)
0:0/0 = 0
1:0/0 = 0
1:1/0 = 0
0:1/0 = 0

[sub_resource type="TileSet" id="TileSet_6iyac"]
tile_size = Vector2i(8, 8)
sources/0 = SubResource("TileSetAtlasSource_d1ilt")

[node name="Game" type="Node"]
script = SubResource("GDScript_ynf5e")

[node name="Simulation" type="Node2D" parent="." node_paths=PackedStringArray("world", "timeManager")]
z_index = 10
script = ExtResource("1_o5yvi")
world = NodePath("../World")
timeManager = NodePath("../Time Manager")

[node name="RegionOverlay" type="Sprite2D" parent="Simulation"]
scale = Vector2(16, 16)
centered = false

[node name="TileMapLayer" type="TileMapLayer" parent="Simulation"]
tile_set = SubResource("TileSet_6iyac")

[node name="World" type="Node2D" parent="."]
z_index = -10
z_as_relative = false
script = ExtResource("3_rfjv2")
worldSizeMult = 3
seed = 48590
mapScale = 1.0

[node name="Terrain Map" type="TileMapLayer" parent="World" node_paths=PackedStringArray("camera", "lodMap", "regionSprite")]
scale = Vector2(1.333, 1.333)
tile_set = ExtResource("4_1phco")
script = ExtResource("5_nb51f")
camera = NodePath("../../PlayerCamera")
lodMap = NodePath("../LOD Map")
regionSprite = NodePath("../../Simulation/RegionOverlay")
baseRegionOpacity = 1.0

[node name="LOD Map" type="Sprite2D" parent="World"]
scale = Vector2(16, 16)
centered = false

[node name="PlayerCamera" type="Camera2D" parent="."]
position = Vector2(576, 324)
script = ExtResource("6_nnt18")
zoomSpeed = 20.0
minZoom = Vector2(15, 15)

[node name="Time Manager" type="Node" parent="." node_paths=PackedStringArray("world")]
script = ExtResource("7_ewbju")
world = NodePath("../World")
monthsPerTick = 1

[node name="UI" type="CanvasLayer" parent="."]

[node name="Population Label" type="Label" parent="UI" node_paths=PackedStringArray("simManager")]
offset_right = 40.0
offset_bottom = 23.0
theme_override_colors/font_outline_color = Color(0, 0, 0, 1)
theme_override_constants/outline_size = 10
theme_override_font_sizes/font_size = 20
text = "World Population:"
script = ExtResource("8_85qyi")
simManager = NodePath("../../Simulation")

[node name="Debug Label" type="Label" parent="UI" node_paths=PackedStringArray("sim")]
offset_right = 40.0
offset_bottom = 23.0
script = ExtResource("9_iivbl")
sim = NodePath("../../Simulation")

[node name="VBoxContainer" type="VBoxContainer" parent="UI"]
offset_left = 1045.0
offset_right = 1152.0
offset_bottom = 60.0

[node name="Date Label" type="Label" parent="UI/VBoxContainer" node_paths=PackedStringArray("timeManager")]
layout_mode = 2
theme_override_colors/font_outline_color = Color(0, 0, 0, 1)
theme_override_constants/outline_size = 10
theme_override_font_sizes/font_size = 20
text = "01/01/0000"
horizontal_alignment = 2
script = ExtResource("10_7nbq1")
timeManager = NodePath("../../../Time Manager")

[node name="TPS Label" type="Label" parent="UI/VBoxContainer" node_paths=PackedStringArray("timeManager")]
layout_mode = 2
theme_override_colors/font_outline_color = Color(0, 0, 0, 1)
theme_override_constants/outline_size = 10
theme_override_font_sizes/font_size = 20
text = "TPS: 30
Fps: 300"
horizontal_alignment = 2
script = ExtResource("11_exi56")
timeManager = NodePath("../../../Time Manager")

[connection signal="worldgenFinished" from="World" to="Simulation" method="on_worldgen_finished"]
[connection signal="worldgenFinished" from="World" to="Time Manager" method="_on_world_worldgen_finished"]
